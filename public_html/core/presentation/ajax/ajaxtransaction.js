function ajaxTransactionList(){var a=new Array();this.addTransaction=function(b){a.push(b)};this.cancelGroup=function(b,c){for(i=0;i<a.length;i++){if((a[i].getTransactionGroup()===b)&&(a[i]!==c)&&(a[i].getStatus()>-1)&&(a[i].getStatus()<3)){a[i].cancelRequest()}}}}var ajaxTransactionList=new ajaxTransactionList();function ajaxTransaction(formElement){var names=new Array();var values=new Array();var connectionpoint="/core/logic/ajax/ajax.php";var that=this;var progressindicator;var formData=new FormData();var transactionGroup=null;var status=0;this.onComplete=null;this.successIndicator=null;this.errorList=null;this.resultLength=null;this.result=null;this.destination=null;this.phpfunction=null;if(formElement){constructor(formElement)}ajaxTransactionList.addTransaction(this);function constructor(formElement){if(document.getElementById(formElement)){formData=new FormData(document.getElementById(formElement))}else{throw formElement+" is not a valid element"}}function completePoststring(){if(that.destination!=null&&that.phpfunction!=null){formData.append("destination",that.destination);formData.append("phpfunction",that.phpfunction)}else{throw"both destination and phpfunction need a value"}return formData}function getHTTPObject(){var xhr=false;if(window.XMLHttpRequest){xhr=new XMLHttpRequest()}else{if(window.ActiveXObject){try{xhr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xhr=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){xhr=false}}}}return xhr}function setStatus(newStatus){if(status>-1){status=newStatus}}this.getStatus=function(){return status};this.setTransactionGroup=function(value){ajaxTransactionList.cancelGroup(value);transactionGroup=value};this.getTransactionGroup=function(){return transactionGroup};this.addData=function(name,value){formData.append(name,value)};this.getData=function(){return formData};this.setIndicator=function(elementid){if(document.getElementById(elementid)){progressindicator=document.getElementById(elementid);progressindicator.style.visibility="hidden"}else{throw"element aangeleverd met setIndicator bestaat niet"}};this.cancelRequest=function(){if(status<3){setStatus(-1)}};this.ExecuteRequest=function(){var request=getHTTPObject();request.onreadystatechange=function(){if(request.readyState==4){if(request.status==200){setStatus(2);if(typeof that.onComplete!="function"){throw"onComplete() is niet gedefinieerd"}else{if(progressindicator){progressindicator.style.visibility="hidden"}if(that.getStatus()>-1){var xml=request.responseXML;if(xml){result=xml.getElementsByTagName("result")[0].firstChild.nodeValue;if(result=="ok"){that.successIndicator=true;var resultrows=xml.getElementsByTagName("datarow");if(resultrows.length>0){that.resultLength=resultrows.length;var firstrow=resultrows[0];var fieldnames=new Array();for(i=0;i<firstrow.childNodes.length;i++){var fieldname=firstrow.childNodes[i].nodeName;fieldnames.push(fieldname)}var code="";for(i=0;i<fieldnames.length;i++){var nieuwecode="this."+fieldnames[i]+"= null;";code=code+nieuwecode}code=" resultSet = function () { "+code+"}";eval(code);var rows=new Array();for(i=0;i<resultrows.length;i++){var instantie=new resultSet();var toewijzingscode="";var huidigerij=resultrows[i];for(x=0;x<fieldnames.length;x++){if(huidigerij.getElementsByTagName(fieldnames[x])[0].firstChild){var fieldvalue=huidigerij.getElementsByTagName(fieldnames[x])[0].firstChild.nodeValue}else{var fieldvalue=null}var naam=fieldnames[x];toewijzingscode=toewijzingscode+"instantie."+naam+'="'+fieldvalue+'";'}eval(toewijzingscode);rows.push(instantie);that.result=rows}}else{}}else{if(result=="error"){that.successIndicator=false;var errortags=xml.getElementsByTagName("error");var errorlist=new Array();for(i=0;i<errortags.length;i++){function Error(parameter,value){this.parameter=parameter;this.value=value}newerror=new Error(errortags[i].getElementsByTagName("parameter")[0].firstChild.nodeValue,errortags[i].getElementsByTagName("message")[0].firstChild.nodeValue);errorlist[i]=newerror}that.errorList=errorlist}else{throw"onverwacht resultaat: resulttag heeft onverwachte waarde"}}if(that.getStatus()>-1){that.onComplete(request);setStatus(3)}}else{throw"onverwacht resultaat: resulttag ontbreekt. Response was: "+request.responseText}}}}}};request.open("POST",connectionpoint,true);if(progressindicator){progressindicator.style.visibility="visible"}request.send(completePoststring());setStatus(1)}};